{% extends "base.html" %}

{% block title %}Reports - Banking Management System{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-chart-bar"></i> Reports & Analytics
        </h1>
    </div>
</div>

<div class="row">
    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-filter"></i> Report Categories</h5>
            </div>
            <div class="list-group list-group-flush">
                <a href="#customer-reports" class="list-group-item list-group-item-action" 
                   onclick="showReportCategory('customer-reports')">
                    <i class="fas fa-users"></i> Customer Reports
                </a>
                <a href="#account-reports" class="list-group-item list-group-item-action" 
                   onclick="showReportCategory('account-reports')">
                    <i class="fas fa-credit-card"></i> Account Reports
                </a>
                <a href="#transaction-reports" class="list-group-item list-group-item-action" 
                   onclick="showReportCategory('transaction-reports')">
                    <i class="fas fa-exchange-alt"></i> Transaction Reports
                </a>
                <a href="#loan-reports" class="list-group-item list-group-item-action" 
                   onclick="showReportCategory('loan-reports')">
                    <i class="fas fa-money-bill-wave"></i> Loan Reports
                </a>
                <a href="#financial-reports" class="list-group-item list-group-item-action" 
                   onclick="showReportCategory('financial-reports')">
                    <i class="fas fa-chart-line"></i> Financial Reports
                </a>
            </div>
        </div>
    </div>

    <div class="col-md-9">
        <!-- Customer Reports -->
        <div id="customer-reports" class="report-category">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-users"></i> Customer Reports</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h6 class="card-title">Customer Summary</h6>
                                    <p class="card-text">Overview of all customers with account and balance information.</p>
                                    <button class="btn btn-primary btn-sm" onclick="generateReport('customer-summary')">
                                        <i class="fas fa-file-alt"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h6 class="card-title">Top Customers by Balance</h6>
                                    <p class="card-text">List of customers with highest account balances.</p>
                                    <button class="btn btn-success btn-sm" onclick="generateReport('top-customers')">
                                        <i class="fas fa-trophy"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-info">
                                <div class="card-body">
                                    <h6 class="card-title">Customer Activity</h6>
                                    <p class="card-text">Customer transaction activity and engagement metrics.</p>
                                    <button class="btn btn-info btn-sm" onclick="generateReport('customer-activity')">
                                        <i class="fas fa-chart-bar"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-warning">
                                <div class="card-body">
                                    <h6 class="card-title">Dormant Accounts</h6>
                                    <p class="card-text">Accounts with no recent transaction activity.</p>
                                    <button class="btn btn-warning btn-sm" onclick="generateReport('dormant-accounts')">
                                        <i class="fas fa-exclamation-triangle"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Account Reports -->
        <div id="account-reports" class="report-category" style="display: none;">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-credit-card"></i> Account Reports</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h6 class="card-title">Account Balance Summary</h6>
                                    <p class="card-text">Summary of account balances by account type.</p>
                                    <button class="btn btn-primary btn-sm" onclick="generateReport('balance-summary')">
                                        <i class="fas fa-calculator"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h6 class="card-title">Interest Calculation</h6>
                                    <p class="card-text">Monthly interest calculations for savings accounts.</p>
                                    <button class="btn btn-success btn-sm" onclick="generateReport('interest-calculation')">
                                        <i class="fas fa-percentage"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Reports -->
        <div id="transaction-reports" class="report-category" style="display: none;">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-exchange-alt"></i> Transaction Reports</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h6 class="card-title">Daily Transaction Summary</h6>
                                    <p class="card-text">Daily breakdown of all transaction types and volumes.</p>
                                    <button class="btn btn-primary btn-sm" onclick="generateReport('daily-transactions')">
                                        <i class="fas fa-calendar-day"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h6 class="card-title">Monthly Transaction Report</h6>
                                    <p class="card-text">Monthly transaction trends and analysis.</p>
                                    <button class="btn btn-success btn-sm" onclick="generateReport('monthly-transactions')">
                                        <i class="fas fa-calendar-alt"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-info">
                                <div class="card-body">
                                    <h6 class="card-title">High Value Transactions</h6>
                                    <p class="card-text">Transactions above specified threshold amounts.</p>
                                    <button class="btn btn-info btn-sm" onclick="generateReport('high-value-transactions')">
                                        <i class="fas fa-exclamation-circle"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-warning">
                                <div class="card-body">
                                    <h6 class="card-title">Transaction Volume Analysis</h6>
                                    <p class="card-text">Analysis of transaction volumes by customer and account.</p>
                                    <button class="btn btn-warning btn-sm" onclick="generateReport('volume-analysis')">
                                        <i class="fas fa-chart-area"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loan Reports -->
        <div id="loan-reports" class="report-category" style="display: none;">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-money-bill-wave"></i> Loan Reports</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h6 class="card-title">Loan Portfolio Summary</h6>
                                    <p class="card-text">Overview of all loans by type and status.</p>
                                    <button class="btn btn-primary btn-sm" onclick="generateReport('loan-portfolio')">
                                        <i class="fas fa-briefcase"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-danger">
                                <div class="card-body">
                                    <h6 class="card-title">Overdue Loans</h6>
                                    <p class="card-text">List of loans that are past their due date.</p>
                                    <button class="btn btn-danger btn-sm" onclick="generateReport('overdue-loans')">
                                        <i class="fas fa-exclamation-triangle"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h6 class="card-title">Loan Performance</h6>
                                    <p class="card-text">Analysis of loan approval rates and collections.</p>
                                    <button class="btn btn-success btn-sm" onclick="generateReport('loan-performance')">
                                        <i class="fas fa-chart-line"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-info">
                                <div class="card-body">
                                    <h6 class="card-title">EMI Schedule Report</h6>
                                    <p class="card-text">Detailed EMI schedules and payment tracking.</p>
                                    <button class="btn btn-info btn-sm" onclick="generateReport('emi-schedule')">
                                        <i class="fas fa-calendar-check"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Reports -->
        <div id="financial-reports" class="report-category" style="display: none;">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> Financial Reports</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card border-primary">
                                <div class="card-body">
                                    <h6 class="card-title">Profitability Analysis</h6>
                                    <p class="card-text">Customer profitability and revenue analysis.</p>
                                    <button class="btn btn-primary btn-sm" onclick="generateReport('profitability')">
                                        <i class="fas fa-dollar-sign"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-success">
                                <div class="card-body">
                                    <h6 class="card-title">Interest Income Report</h6>
                                    <p class="card-text">Total interest income from loans and investments.</p>
                                    <button class="btn btn-success btn-sm" onclick="generateReport('interest-income')">
                                        <i class="fas fa-coins"></i> Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Output Area -->
        <div id="report-output" class="card" style="display: none;">
            <div class="card-header">
                <h5 class="mb-0"><i class="fas fa-file-alt"></i> Report Output</h5>
                <div class="float-end">
                    <button class="btn btn-sm btn-outline-primary" onclick="exportReport('pdf')">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button class="btn btn-sm btn-outline-success" onclick="exportReport('excel')">
                        <i class="fas fa-file-excel"></i> Export Excel
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="report-content">
                    <!-- Report content will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showReportCategory(categoryId) {
    // Hide all report categories
    const categories = document.querySelectorAll('.report-category');
    categories.forEach(category => {
        category.style.display = 'none';
    });
    
    // Show selected category
    document.getElementById(categoryId).style.display = 'block';
    
    // Update active state in navigation
    const navItems = document.querySelectorAll('.list-group-item');
    navItems.forEach(item => {
        item.classList.remove('active');
    });
    event.target.classList.add('active');
}

function generateReport(reportType) {
    // Show loading state
    document.getElementById('report-output').style.display = 'block';
    document.getElementById('report-content').innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Generating ${reportType} report...</p>
        </div>
    `;
    
    // Simulate report generation
    setTimeout(() => {
        let reportContent = '';
        
        switch(reportType) {
            case 'customer-summary':
                reportContent = generateCustomerSummaryReport();
                break;
            case 'balance-summary':
                reportContent = generateBalanceSummaryReport();
                break;
            case 'daily-transactions':
                reportContent = generateDailyTransactionReport();
                break;
            case 'overdue-loans':
                reportContent = generateOverdueLoansReport();
                break;
            default:
                reportContent = `
                    <div class="alert alert-info">
                        <h6>Report: ${reportType}</h6>
                        <p>This report would contain detailed ${reportType} information from the database.</p>
                        <p>In a real implementation, this would execute the corresponding SQL queries from the Reports/report_queries.sql file.</p>
                    </div>
                `;
        }
        
        document.getElementById('report-content').innerHTML = reportContent;
    }, 2000);
}

function generateCustomerSummaryReport() {
    return `
        <h6>Customer Account Summary Report</h6>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Customer ID</th>
                        <th>Customer Name</th>
                        <th>Email</th>
                        <th>Total Accounts</th>
                        <th>Active Accounts</th>
                        <th>Total Balance</th>
                        <th>Member Since</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1001</td>
                        <td>John Doe</td>
                        <td>john.doe@email.com</td>
                        <td>2</td>
                        <td>2</td>
                        <td>₹45,000.00</td>
                        <td>2023-01-15</td>
                    </tr>
                    <tr>
                        <td>1002</td>
                        <td>Jane Smith</td>
                        <td>jane.smith@email.com</td>
                        <td>1</td>
                        <td>1</td>
                        <td>₹32,500.00</td>
                        <td>2023-02-20</td>
                    </tr>
                    <tr>
                        <td>1003</td>
                        <td>Robert Johnson</td>
                        <td>robert.j@email.com</td>
                        <td>1</td>
                        <td>1</td>
                        <td>₹78,000.00</td>
                        <td>2023-01-10</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="mt-3">
            <small class="text-muted">Report generated on: ${new Date().toLocaleString()}</small>
        </div>
    `;
}

function generateBalanceSummaryReport() {
    return `
        <h6>Account Balance Summary by Type</h6>
        <div class="row">
            <div class="col-md-6">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Account Type</th>
                                <th>Total Accounts</th>
                                <th>Total Balance</th>
                                <th>Average Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Savings</td>
                                <td>4</td>
                                <td>₹1,25,500.00</td>
                                <td>₹31,375.00</td>
                            </tr>
                            <tr>
                                <td>Current</td>
                                <td>2</td>
                                <td>₹40,000.00</td>
                                <td>₹20,000.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="col-md-6">
                <canvas id="balanceChart" width="300" height="200"></canvas>
            </div>
        </div>
    `;
}

function generateDailyTransactionReport() {
    return `
        <h6>Daily Transaction Summary (Last 7 Days)</h6>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Total Transactions</th>
                        <th>Total Deposits</th>
                        <th>Total Withdrawals</th>
                        <th>Total Transfers</th>
                        <th>Net Amount</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2025-01-20</td>
                        <td>15</td>
                        <td>₹25,000.00</td>
                        <td>₹8,500.00</td>
                        <td>₹12,000.00</td>
                        <td>₹45,500.00</td>
                    </tr>
                    <tr>
                        <td>2025-01-19</td>
                        <td>12</td>
                        <td>₹18,000.00</td>
                        <td>₹6,200.00</td>
                        <td>₹9,500.00</td>
                        <td>₹33,700.00</td>
                    </tr>
                    <tr>
                        <td>2025-01-18</td>
                        <td>8</td>
                        <td>₹12,500.00</td>
                        <td>₹4,000.00</td>
                        <td>₹7,200.00</td>
                        <td>₹23,700.00</td>
                    </tr>
                </tbody>
            </table>
        </div>
    `;
}

function generateOverdueLoansReport() {
    return `
        <h6>Overdue Loans Report</h6>
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> 
            <strong>Alert:</strong> The following loans are past their due date and require immediate attention.
        </div>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Loan ID</th>
                        <th>Customer Name</th>
                        <th>Phone</th>
                        <th>Loan Type</th>
                        <th>Outstanding Balance</th>
                        <th>EMI Amount</th>
                        <th>Days Overdue</th>
                        <th>Action Required</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="table-danger">
                        <td>10001</td>
                        <td>John Doe</td>
                        <td>9876543210</td>
                        <td>Personal</td>
                        <td>₹45,000.00</td>
                        <td>₹2,347.50</td>
                        <td>15</td>
                        <td><span class="badge bg-danger">Follow-up Required</span></td>
                    </tr>
                    <tr class="table-warning">
                        <td>10003</td>
                        <td>Robert Johnson</td>
                        <td>9876543212</td>
                        <td>Home</td>
                        <td>₹4,85,000.00</td>
                        <td>₹4,240.50</td>
                        <td>7</td>
                        <td><span class="badge bg-warning">Send Reminder</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    `;
}

function exportReport(format) {
    alert(`Report would be exported in ${format.toUpperCase()} format`);
}

// Show customer reports by default
document.addEventListener('DOMContentLoaded', function() {
    showReportCategory('customer-reports');
    document.querySelector('a[href="#customer-reports"]').classList.add('active');
});
</script>
{% endblock %}